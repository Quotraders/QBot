name: Cup_And_Handle_Breakout
family: structural
priority: low
enabled: true
description: "Cup and handle pattern breakout with volume confirmation and measured moves"

telemetry_tags:
  - "CupAndHandle"
  - "StructuralBreakout"
  - "PatternBreakout"
  - "MeasuredMove"

regime_filters:
  required:
    - market_regime != "HighVol"
  preferred:
    - market_regime == "Range" OR market_regime == "LowVol"

zone_conditions:
  preferred:
    - zone.distance_atr >= 0.8  # Away from immediate zone influence
  contraindications:
    - zone.distance_atr <= 0.4 AND zone.type == "resistance" # For bullish cup

pattern_conditions:
  confluence:
    - pattern.kind::CupAndHandle
    - pattern.kind::RoundingBottom
  required:
    - cup.depth >= 0.12 AND cup.depth <= 0.50  # Proper cup depth
    - handle.depth <= 0.33 * cup.depth  # Handle should be shallow relative to cup
  contraindications:
    - pattern.kind::DoubleTop OR pattern.kind::HeadAndShoulders
    - pattern.kind::TrendExhaustion

micro_conditions:
  entry_triggers:
    - breakout.confirmed == true  # Price above handle high
    - volume.breakout_spike >= 1.5  # Volume confirmation
    - handle.consolidation_time >= 5  # Adequate consolidation
    - momentum.bullish == true
  
  timing:
    - time_of_day >= "10:30" AND time_of_day <= "14:30"
    - handle.formation_complete == true

risk_management:
  position_sizing:
    base_size: 1
    confidence_multiplier: true
    max_size: 3
    
  stop_loss:
    type: "handle_based"
    distance_below_handle_low: 0.3  # ATR
    minimum_distance: 8
    
  take_profit:
    type: "measured_move"
    target: "breakout_level + cup_depth"  # Classic measured move
    partial_exit: 0.5  # Half position at target

confidence_calculation:
  base_confidence: 0.55
  
  boosters:
    - volume.breakout_spike >= 2.0: +0.15
    - cup.symmetry >= 0.7: +0.10  # Well-formed cup
    - handle.slope_angle <= 15: +0.08  # Proper handle angle
    - pattern.duration >= 20 AND pattern.duration <= 60: +0.05
    
  penalties:
    - handle.depth >= 0.5 * cup.depth: -0.15  # Handle too deep
    - volume.during_formation < 0.6: -0.10  # Weak volume pattern
    - time_to_close_minutes <= 90: -0.12

direction_logic:
  long_conditions:
    - cup.orientation == "UP"  # Bullish cup and handle
    - breakout.direction == "UP"
    - volume.confirmation == true
    - handle.resistance_break == true

metadata:
  version: "1.0"
  author: "TradingBot"
  last_updated: "2024-12-21"