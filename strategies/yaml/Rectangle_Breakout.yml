name: Rectangle_Breakout
family: structural
priority: medium
enabled: true  
description: "Rectangle pattern breakout strategy with range confirmation and momentum follow-through"

telemetry_tags:
  - "Rectangle"
  - "RangeBreakout" 
  - "PatternBreakout"
  - "BidirectionalSetup"

regime_filters:
  required:
    - market_regime == "Range" OR market_regime == "Consolidation"
  blocked:
    - market_regime == "HighVol" AND volatility_z_score > 2.5

zone_conditions:
  preferred:
    - rectangle.touches_zones == true  # Rectangle aligned with zones
  contraindications:
    - zone.distance_atr <= 0.2  # Too close to interfering zone

pattern_conditions:
  confluence:
    - pattern.kind::Rectangle OR pattern.kind::Consolidation
    - pattern.kind::Compression  # Volatility compression within rectangle
  required:
    - rectangle.test_count >= 4  # Multiple tests of boundaries
    - rectangle.duration >= 8  # Adequate consolidation time
  contraindications:
    - pattern.kind::Triangle  # Need parallel boundaries
    - pattern.kind::Wedge

micro_conditions:
  entry_triggers:
    - breakout.confirmed == true  # Clear break of rectangle boundary
    - volume.breakout_confirmation >= 1.3
    - false_breakout.recent == false  # No recent false breaks
    - momentum.alignment == "breakout_direction"
  
  timing:
    - time_of_day >= "10:00" AND time_of_day <= "15:00"
    - rectangle.maturity >= 0.7  # Well-developed pattern

risk_management:
  position_sizing:
    base_size: 2
    confidence_multiplier: true
    volatility_adjusted: true
    max_size: 5
    
  stop_loss:
    type: "rectangle_based"
    distance_inside_rectangle: 0.3  # ATR back into rectangle
    minimum_distance: 6
    
  take_profit:
    type: "measured_move"
    target: "breakout_level + rectangle_height"
    partial_exits: [0.5, 0.7, 1.0]  # Scale out approach

confidence_calculation:
  base_confidence: 0.58
  
  boosters:
    - volume.breakout_spike >= 2.0: +0.18
    - rectangle.height >= 0.015: +0.10  # Meaningful range size
    - rectangle.test_count >= 6: +0.08  # Well-tested boundaries
    - false_breakout.recent == false: +0.06
    
  penalties:
    - rectangle.height <= 0.005: -0.15  # Range too narrow
    - volume.during_formation < 0.5: -0.12  # Weak participation
    - time_to_close_minutes <= 75: -0.10

direction_logic:
  long_conditions:
    - breakout.direction == "UP"
    - price > rectangle.upper_boundary
    - volume.confirmation == true
    - momentum.z_score > 0.3
    
  short_conditions:
    - breakout.direction == "DOWN"
    - price < rectangle.lower_boundary  
    - volume.confirmation == true
    - momentum.z_score < -0.3

metadata:
  version: "1.0"
  author: "TradingBot"
  last_updated: "2024-12-21"